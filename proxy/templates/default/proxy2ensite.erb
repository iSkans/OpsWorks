#!/bin/bash

#-- Configuration --#
NGINX='<%= node[:nginx][:dir] %>'
APP_NAME=$1
APP_DIR=$2

#-- Retrieve Proxy ip and port from package.json --#
IP=`sed -n 's/[\t ]*"proxy":[\t ]*"\([^"]*\).*/\1/p' $APP_DIR/package.json`
PORT=`sed -n 's/[\t ]*"port":[\t ]*"\([^"]*\).*/\1/p' $APP_DIR/package.json`

#-- Available Proxy Website --#
echo "server {
	listen 80;
	server_name $DOMAINS;
	location / {
		proxy_pass http://$IP:$PORT/;
	}
}
$@
"> $NGINX/vhost.d/$APP_NAME
